<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>è®°å½•æ•°æ® - Health Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body { background-color: #f0f2f5; font-family: 'Nunito', sans-serif; }
        .navbar { background-color: #fff; box-shadow: 0 2px 15px rgba(0,0,0,0.05); }
        .record-card { border: none; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); background: #fff; margin-bottom: 20px; overflow: hidden; }
        .card-header-custom { background: #fff; border-bottom: 1px solid #f0f0f0; padding: 20px 25px; }
        .form-label { font-weight: 600; color: #495057; font-size: 0.9rem; margin-bottom: 8px; }
        .input-group-text { background-color: #f8f9fa; border: 1px solid #dee2e6; color: #6c757d; }
        .form-control:focus { box-shadow: none; border-color: #11998e; }
        .history-item { border-left: 4px solid transparent; transition: all 0.2s; }
        .history-item:hover { background-color: #f8f9fa; border-left-color: #11998e; transform: translateX(5px); }
        .badge-date { background-color: #e3f2fd; color: #0d6efd; font-weight: bold; }
        .btn-sync { background: linear-gradient(45deg, #4facfe, #00f2fe); border: none; color: white; font-weight: bold; }
        .btn-sync:hover { background: linear-gradient(45deg, #00f2fe, #4facfe); color: white; }
        .btn-save { background: linear-gradient(45deg, #11998e, #38ef7d); border: none; padding: 12px; font-size: 1.1rem; border-radius: 10px; }
        .btn-save:hover { background: linear-gradient(45deg, #38ef7d, #11998e); }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg sticky-top mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="{{ url_for('main.dashboard') }}">
            <i class="bi bi-chevron-left me-2"></i>è¿”å›ä»ªè¡¨ç›˜
        </a>
        <span class="navbar-text fw-bold text-dark">ğŸ“ æ¯æ—¥æ‰“å¡</span>
    </div>
</nav>

<div class="container pb-5">
    <div class="row">
        <div class="col-lg-8">
            <div class="record-card">
                <div class="card-header-custom d-flex justify-content-between align-items-center">
                    <h5 class="m-0 fw-bold text-dark"><i class="bi bi-pencil-square text-primary me-2"></i>å½•å…¥ä»Šæ—¥æ•°æ®</h5>
                    <button type="button" class="btn btn-sm btn-sync rounded-pill px-3 py-2 shadow-sm" onclick="syncDeviceData()">
                        <i class="bi bi-smartwatch me-1"></i> ä¸€é”®åŒæ­¥è®¾å¤‡
                    </button>
                </div>
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('record.index') }}">
                        <h6 class="text-muted small fw-bold mb-3 text-uppercase ls-1">ğŸƒ è¿åŠ¨ä¸åŸºç¡€</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4"><label class="form-label">æ—¥æœŸ</label><input type="date" class="form-control" id="date" name="date" required></div>
                            <div class="col-md-4"><label class="form-label">ä½“é‡ (kg)</label><div class="input-group"><span class="input-group-text"><i class="bi bi-speedometer2"></i></span><input type="number" step="0.1" class="form-control" id="weight" name="weight" placeholder="0.0"></div></div>
                            <div class="col-md-4"><label class="form-label">æ­¥æ•°</label><div class="input-group"><span class="input-group-text"><i class="bi bi-footprint"></i></span><input type="number" class="form-control" id="steps" name="steps" placeholder="0"></div></div>
                        </div>

                        <h6 class="text-muted small fw-bold mb-3 text-uppercase ls-1 border-top pt-3">ğŸŒ™ ç¡çœ  & æ¶ˆè€—</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-md-4"><label class="form-label">ç¡çœ  (å°æ—¶)</label><div class="input-group"><span class="input-group-text"><i class="bi bi-moon-stars"></i></span><input type="number" step="0.1" class="form-control" id="sleep_hours" name="sleep_hours"></div></div>
                            <div class="col-md-4"><label class="form-label">é™æ¯å¿ƒç‡ (bpm)</label><div class="input-group"><span class="input-group-text"><i class="bi bi-heart-pulse"></i></span><input type="number" class="form-control" id="heart_rate" name="heart_rate"></div></div>
                            <div class="col-md-4"><label class="form-label">å¡è·¯é‡Œ</label><div class="input-group"><span class="input-group-text"><i class="bi bi-fire"></i></span><input type="number" class="form-control" id="calories" name="calories"></div></div>
                        </div>

                        <h6 class="text-muted small fw-bold mb-3 text-uppercase ls-1 border-top pt-3">ğŸ©º è¡€å‹ & å¤‡æ³¨</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-6"><label class="form-label">é«˜å‹ (mmHg)</label><input type="number" class="form-control" id="blood_pressure_high" name="bp_high"></div>
                            <div class="col-6"><label class="form-label">ä½å‹ (mmHg)</label><input type="number" class="form-control" id="blood_pressure_low" name="bp_low"></div>
                            <div class="col-12"><label class="form-label">ğŸ“ èº«ä½“æ„Ÿè§‰ / å¤‡æ³¨</label><textarea class="form-control" id="note" name="note" rows="2" placeholder="ä»Šå¤©æ„Ÿè§‰å¦‚ä½•ï¼Ÿæœ‰æ— ä¸é€‚ï¼Ÿ"></textarea></div>
                        </div>

                        <button type="submit" class="btn btn-save btn-primary w-100 shadow text-white fw-bold"><i class="bi bi-check-lg me-2"></i>ä¿å­˜æ‰€æœ‰æ•°æ®</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="record-card h-100">
                <div class="card-header-custom"><h6 class="m-0 fw-bold text-secondary">ğŸ“‚ å†å²å½’æ¡£</h6></div>
                <div class="list-group list-group-flush" style="max-height: 700px; overflow-y: auto;">
                    {% for record in records %}
                    <div class="list-group-item history-item p-3 border-0 border-bottom">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge badge-date rounded-pill px-3">{{ record.date }}</span>
                            <small class="text-muted">{{ record.steps }} æ­¥</small>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div><span class="fw-bold text-dark fs-5">{{ record.weight }}</span> <small class="text-muted">kg</small></div>
                            <div class="text-end">{% if record.note %}<i class="bi bi-chat-left-text text-info" title="{{ record.note }}" data-bs-toggle="tooltip"></i>{% endif %}</div>
                        </div>
                        {% if record.blood_pressure_high %}
                        <div class="mt-2 small text-muted"><i class="bi bi-heart me-1"></i>BP: {{ record.blood_pressure_high }}/{{ record.blood_pressure_low }} | HR: {{ record.heart_rate }}</div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="text-center py-5 text-muted"><i class="bi bi-inbox fs-1 mb-2 d-block opacity-50"></i>æš‚æ— è®°å½•ï¼Œå¿«å»æ·»åŠ å§ï¼</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    document.getElementById('date').valueAsDate = new Date();

    function syncDeviceData() {
        const btn = document.querySelector('button[onclick="syncDeviceData()"]');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> åŒæ­¥ä¸­...';
        btn.disabled = true;

        fetch('/api/simulate_import')
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    const data = result.data;
                    document.getElementById('weight').value = data.weight;
                    document.getElementById('steps').value = data.steps;
                    document.getElementById('calories').value = data.calories;
                    document.getElementById('sleep_hours').value = data.sleep_hours;
                    document.getElementById('heart_rate').value = data.heart_rate;
                    document.getElementById('blood_pressure_high').value = data.bp_high;
                    document.getElementById('blood_pressure_low').value = data.bp_low;
                    document.getElementById('note').value = data.note;
                    
                    btn.classList.remove('btn-sync');
                    btn.classList.add('btn-success');
                    btn.innerHTML = '<i class="bi bi-check-lg"></i> åŒæ­¥æˆåŠŸ';
                    setTimeout(() => { btn.innerHTML = originalContent; btn.classList.remove('btn-success'); btn.classList.add('btn-sync'); btn.disabled = false; }, 2000);
                } else { alert('åŒæ­¥å¤±è´¥ï¼š' + result.message); btn.innerHTML = originalContent; btn.disabled = false; }
            })
            .catch(error => { console.error('Error:', error); alert('è¿æ¥é”™è¯¯'); btn.innerHTML = originalContent; btn.disabled = false; });
    }
</script>
</body>
</html>