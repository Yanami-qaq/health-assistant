<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>AI æ™ºèƒ½å¥åº·é¡¾é—®</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* è®© AI çš„å»ºè®®æ˜¾ç¤ºå¾—æ›´å¥½çœ‹ï¼Œä¿ç•™æ¢è¡Œç¬¦ */
        .ai-content { white-space: pre-wrap; line-height: 1.8; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container">
        <div>
            <a href="/record" class="text-white me-3">è¿”å›è®°å½•é¡µ</a>
            <a href="/logout" class="btn btn-sm btn-danger">é€€å‡º</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow mb-4">
                <div class="card-body text-center">
                    <h4 class="card-title mb-3">ğŸ‘‹ ä½ å¥½ï¼Œ{{ nickname }}</h4>
                    <p class="text-muted">å‘Šè¯‰æˆ‘ä½ çš„å¥åº·ç›®æ ‡ï¼Œæˆ‘ä¼šç»“åˆä½ çš„å†å²æ•°æ®ä¸ºä½ å®šåˆ¶è®¡åˆ’ã€‚</p>
                    
                    <form method="POST">
                        <div class="input-group input-group-lg">
                            <input type="text" class="form-control" name="goal" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³åœ¨ä¸€ä¸ªæœˆå†…å‡æ‰ 2kg..." required>
                            <button class="btn btn-primary" type="submit">âœ¨ ç”Ÿæˆæ™ºèƒ½è®¡åˆ’</button>
                        </div>
                    </form>
                </div>
            </div>
            {% if latest_plan %}
            <div class="card shadow border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">ğŸ’¡ ä¸ºä½ ç”Ÿæˆçš„æœ€æ–°æ–¹æ¡ˆ ({{ latest_plan.created_at.strftime('%Y-%m-%d') }})</h5>
                </div>
                <div class="card-body">
                    <h6 class="text-primary">ä½ çš„ç›®æ ‡ï¼š{{ latest_plan.goal }}</h6>
                    <hr>
                    
                    <div id="ai-result" class="ai-content" style="line-height: 1.8;"></div>
                </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

            <script>
                // è·å–åç«¯ä¼ æ¥çš„æ–‡æœ¬
                var rawText = {{ latest_plan.content | tojson }};
                
                // æ‰¾åˆ°åˆšæ‰é‚£ä¸ª div
                var resultDiv = document.getElementById('ai-result');

                // å¦‚æœæœ‰å†…å®¹ï¼Œè½¬æ¢æˆ HTML æ˜¾ç¤ºï¼›æ²¡å†…å®¹æ˜¾ç¤ºæç¤º
                if (rawText) {
                    resultDiv.innerHTML = marked.parse(rawText);
                } else {
                    resultDiv.innerHTML = "<p class='text-muted'>æš‚æ— è¯¦ç»†å†…å®¹</p>";
                }
            </script>
            {% endif %}
        </div>
    </div>
</div>

</body>
</html>